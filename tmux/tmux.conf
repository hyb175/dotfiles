# =====================================
# TMUX Configuration
# =====================================

# =====================================
# Server Options
# =====================================
# Set default terminal with 256 color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Reduce escape time for faster key response
set -sg escape-time 0

# Enable focus events for vim compatibility
set -g focus-events on

# =====================================
# Session Options
# =====================================
# Increase scrollback buffer size
set -g history-limit 10000

# Enable mouse support for all interactions
set -g mouse on

# Set window title
set -g set-titles on
set -g set-titles-string '#h ❐ #S ● #I #W'

# =====================================
# Window Options
# =====================================
# Start window indices at 1 instead of 0
set -g base-index 1

# Renumber windows automatically when one is closed
set -g renumber-windows on

# Monitor window activity
setw -g monitor-activity on
set -g visual-activity off
setw -g window-status-activity-style fg=colour166,bg=colour235

# Enable aggressive resize
setw -g aggressive-resize on

# =====================================
# Pane Options
# =====================================
# Start pane indices at 1 instead of 0
setw -g pane-base-index 1

# =====================================
# Key Bindings - Prefix
# =====================================
# Change prefix from Ctrl-b to Ctrl-a
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# =====================================
# Key Bindings - Config Management
# =====================================
# Reload config file with display notification
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded!"

# =====================================
# Key Bindings - Pane Management
# =====================================
# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Navigate panes using vim-style keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with vim-style keys (repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick pane cycling
bind -r Tab select-pane -t :.+

# =====================================
# Key Bindings - Session Management
# =====================================
# Create new session
bind S new-session

# Launch development environment
bind D run-shell "~/.config/tmux/scripts/dev-env.sh"

# =====================================
# Key Bindings - Window Management
# =====================================
# Create new window in current directory
bind c new-window -c "#{pane_current_path}"

# Navigate windows (repeatable)
bind -r n next-window
bind -r p previous-window

# =====================================
# Copy Mode Configuration
# =====================================
# Use vim keybindings in copy mode
setw -g mode-keys vi

# Enter copy mode with Prefix + Enter
bind Enter copy-mode

# Setup 'v' to begin selection as in Vim
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Update default binding of `Enter` to also use copy-pipe
unbind -T copy-mode-vi Enter

# =====================================
# Status Bar Configuration
# =====================================
# Enable status bar
set -g status on
set -g status-interval 5
set -g status-position bottom

# =====================================
# Theme Configuration - tmux2k
# =====================================
# Set theme
set -g @tmux2k-theme 'catppuccin'

# Configure left and right status bar
set -g @tmux2k-left-plugins "git cpu ram"
set -g @tmux2k-right-plugins "battery network time"

# Configure window icons
set -g @tmux2k-window-list-alignment 'centre'
set -g @tmux2k-icons-only false

# Time format
set -g @tmux2k-military-time true

# Network interface  
set -g @tmux2k-network-name "en0"

# =====================================
# Plugin Configuration
# =====================================
# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin '2kabhishek/tmux2k'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# =====================================
# SessionX Configuration
# =====================================
# SessionX key binding (default is prefix + o)
set -g @sessionx-bind 'o'

# Preview location and size
set -g @sessionx-window-height '85%'
set -g @sessionx-window-width '75%'
set -g @sessionx-preview-enabled 'true'
set -g @sessionx-preview-location 'right'
set -g @sessionx-preview-ratio '55%'

# Additional settings
set -g @sessionx-zoxide-mode 'on'  # Enable zoxide integration if installed
set -g @sessionx-filter-current 'false'  # Include current session in list
set -g @sessionx-legacy-fzf-support 'off'  # Use newer fzf features

# =====================================
# Resurrect & Continuum Configuration
# =====================================
# Enable automatic restore when tmux is started
set -g @continuum-restore 'on'

# Save sessions automatically every 15 minutes
set -g @continuum-save-interval '15'

# Restore vim/neovim sessions
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# Restore pane contents
set -g @resurrect-capture-pane-contents 'on'

# Additional programs to restore
set -g @resurrect-processes 'ssh node npm yarn "npm start" "npm run" "yarn start" "yarn dev"'

# =====================================
# Plugin Manager Initialization
# =====================================
# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.config/tmux/plugins/tpm/tpm'
